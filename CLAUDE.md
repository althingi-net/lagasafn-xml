# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Architecture

This is a multi-component project for processing and displaying Icelandic law:

1. **Lagasafn-XML** (`lagasafn/`): Python package that parses HTML versions of Icelandic law and converts them to structured XML
2. **Codex-API** (`codex-api/`): Django REST API backend that serves the processed legal data  
3. **Codex-UI** (`codex-ui/`): SolidJS frontend web application for browsing the legal codex
4. **Data** (`data/`): Static XML files generated by Lagasafn-XML and consumed by the API

### Key Components

- `lagasafn-xml`: Main command-line script for processing laws
- `lagasafn/`: Core Python parsing and processing logic
- `codex-api/manage.py`: Django management interface
- `codex-ui/`: SolidStart-based frontend application

## Development Commands

### Python/Django Backend (codex-api)

```bash
# Install Python dependencies
pip install -r requirements.txt

# Run Django development server
cd codex-api && python manage.py runserver

# Run Django tests
cd codex-api && python manage.py test
```

### Frontend (codex-ui)

```bash
cd codex-ui

# Install dependencies
npm install

# Development server
npm run dev

# Build for production
npm run build

# Start production server
npm run start

# Lint code
npm run lint

# Fix linting issues
npm run lint:fix

# Generate API client from OpenAPI spec
npm run generate-client-sdk
```

### XML Processing

```bash
# Process a specific law (e.g., law 134/1995)
./lagasafn-xml 134/1995

# View usage instructions
./lagasafn-xml
```

## Code Style and Formatting

- **Python**: Uses Black formatter (configured in VSCode settings)
- **JavaScript/TypeScript**: Uses ESLint with Stylistic plugin
- **ESLint working directory**: `codex-ui` (configured in VSCode settings)

## Data Processing Workflow

1. Download law data from <http://www.althingi.is/lagasafn/zip-skra-af-lagasafni/>
2. Use `lagasafn-xml` script to process HTML into XML
3. Generated XML files stored in `data/xml/`
4. Django API serves processed data to frontend

## Error Patching System

When HTML parsing fails, create patches in `patches/[version]/` directory:

1. Process law to generate `cleaned/` version
2. Fix errors in `patched/` version
3. Generate patch file with diff utilities
4. Document the fix in patch file header

## Architecture Notes

- Laws are identified by number/year format (e.g., 33/1944 for Iceland's constitution)
- XML files named as `[year].[number].xml`
- Frontend uses SolidJS with TailwindCSS v4
- Backend provides OpenAPI/Swagger documentation
- Multi-language support configured in Django
